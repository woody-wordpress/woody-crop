var yoimgMediaUploader;function yoimgLoadCropThickbox(e,t){jQuery.get(e,(function(e){t?jQuery("#yoimg-cropper-wrapper .media-modal-content").empty().append(e):jQuery("body").append(e)}))}function yoimgAddEditImageAnchors(){setInterval((function(){jQuery("#media-items .edit-attachment").length&&jQuery("#media-items .edit-attachment").each((function(e,t){try{var i=jQuery(this),r=/\?post=([0-9]+)/.exec(i.attr("href"));if(!i.parent().find(".yoimg").length&&i.parent().find(".pinkynail").attr("src").match(/upload/g)){var o={action:"yoimg_get_edit_image_anchor",post:r[1]};jQuery.post(ajaxurl,o,(function(e){i.after(e)}))}}catch(e){console.log(e)}}))}),1e3)}function yoimgExtendMediaLightboxTemplate(e,t,i,r){var o=jQuery("#tmpl-attachment-details").text();o=o.replace(/(<(a|button)[^>]+class="[^"]*edit-attachment[^"]*"[^>]*>[^<]*<\/(a|button)>)/,"\n$1"+e),jQuery("#tmpl-attachment-details").text(o);var a=jQuery("#tmpl-attachment-details-two-column").text();a=(a=a.replace(/(<a[^>]+class="[^"]*view-attachment[^"]*"[^>]*>[^<]*<\/a>)/,"\n$1 | "+t)).replace(/(<(a|button)[^>]+class="[^"]*edit-attachment[^"]*"[^>]*>[^<]*<\/(a|button)>)/,"\n$1"+i),jQuery("#tmpl-attachment-details-two-column").text(a);var p=jQuery("#tmpl-image-details").text();p=p.replace(/(<input type="button" class="replace-attachment button")/,r+"\n$1"),jQuery("#tmpl-image-details").text(p)}function yoimgInitCropImage(e){if("undefined"!=typeof yoimg_cropper_aspect_ratio){function t(){var e=Math.min(jQuery("#yoimg-cropper-preview-title").width(),yoimg_retina_crop_enabled?yoimg_cropper_min_width/2:yoimg_cropper_min_width);jQuery("#yoimg-cropper-preview").css({height:e/yoimg_cropper_aspect_ratio+"px",width:e+"px"})}var i;function r(){jQuery("#yoimg-replace-restore-wrapper").appendTo("#yoimg-cropper-wrapper .cropper-container")}t(),jQuery(window).resize(t),i="undefined"!=typeof yoimg_prev_crop_x?{x:yoimg_prev_crop_x,y:yoimg_prev_crop_y,width:yoimg_prev_crop_width,height:yoimg_prev_crop_height}:{},jQuery("#yoimg-cropper-container").css({"max-width":jQuery("#yoimg-cropper-wrapper .attachments").width()+"px","max-height":jQuery("#yoimg-cropper-wrapper .attachments").height()+"px"}),jQuery("#yoimg-cropper").on("built.cropper",(function(){e&&yoimgCropImage(),t()})).cropper({aspectRatio:yoimg_cropper_aspect_ratio,minWidth:yoimg_cropper_min_width,minHeight:yoimg_cropper_min_height,modal:!0,data:i,preview:"#yoimg-cropper-preview"}),jQuery(window).on("built.cropper",(function(){setTimeout(r,100)})),wp.media&&jQuery("#yoimg-replace-img-btn").show().click((function(){if(yoimgMediaUploader)return jQuery("#yoimg-replace-media-uploader .media-frame-title h1").text(jQuery(this).attr("title")),void yoimgMediaUploader.open();var e=jQuery(this);(yoimgMediaUploader=wp.media({id:"yoimg-replace-media-uploader",title:e.attr("title"),multiple:!1,button:{text:e.attr("data-button-text")},library:{type:"image"}})).on("select",(function(){attachment=yoimgMediaUploader.state().get("selection").first().toJSON();var e={action:"yoimg_replace_image_for_size",image:yoimg_image_id,size:yoimg_image_size,replacement:attachment.id};jQuery.post(ajaxurl,e,(function(e){yoimgLoadCropThickbox(jQuery("#yoimg-cropper-wrapper .yoimg-thickbox-partial.active").attr("href")+"&immediatecrop=1",!0)}))})),yoimgMediaUploader.open(),jQuery("#yoimg-replace-media-uploader").parents(".media-modal.wp-core-ui").css("z-index","17000002")})),jQuery("#yoimg-restore-img-btn").click((function(){var e={action:"yoimg_restore_original_image_for_size",image:yoimg_image_id,size:yoimg_image_size};jQuery.post(ajaxurl,e,(function(e){yoimgLoadCropThickbox(jQuery("#yoimg-cropper-wrapper .yoimg-thickbox-partial.active").attr("href")+"&immediatecrop=1",!0)}))}))}}function yoimgCancelCropImage(){jQuery("#yoimg-cropper-wrapper").remove()}function yoimgCropImage(){jQuery("#yoimg-cropper-wrapper .spinner").addClass("is-active");var e=jQuery("#yoimg-cropper").cropper("getData");e.action="yoimg_crop_image",e.post=yoimg_image_id,e.size=yoimg_image_size,e.quality=jQuery("#yoimg-cropper-quality").val(),jQuery.post(ajaxurl,e,(function(e){jQuery("img[src*='"+e.previous_filename+"']").each((function(){var t=jQuery(this),i=t.attr("src");i=e.previous_filename===e.filename?i+(i.indexOf("?")>-1?"&":"?")+"_frontend_cachebust="+Math.floor(100*Math.random()+1):i.replace(e.previous_filename,e.filename),t.attr("src",i),t.parents(".yoimg-not-existing-crop").length&&t.parents(".yoimg-not-existing-crop").removeClass("yoimg-not-existing-crop").find(".message.error").hide()})),e.smaller?jQuery(".message.yoimg-crop-smaller").show():jQuery(".message.yoimg-crop-smaller").hide(),e.retina_smaller?jQuery(".message.yoimg-crop-retina-smaller").show():jQuery(".message.yoimg-crop-retina-smaller").hide(),jQuery("#yoimg-cropper-wrapper .spinner").removeClass("is-active"),jQuery(window).resize()}))}function yoimgGetUrlVars(){for(var e,t=[],i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<i.length;r++)e=i[r].split("="),t.push(e[0]),t[e[0]]=e[1];return t}jQuery(document).ready((function(e){if(e("body.post-type-attachment").length){var t=yoimgGetUrlVars().post,i=e("#imgedit-open-btn-"+t);if(i.length){var r={action:"yoimg_get_edit_image_anchor",post:t,classes:"button"};jQuery.post(ajaxurl,r,(function(e){i.after(e)}))}}if(yoimgAddEditImageAnchors(),e(document).on("click","a.yoimg-thickbox",(function(t){t.preventDefault();var i=e(this);return yoimgLoadCropThickbox(i.attr("href"),i.hasClass("yoimg-thickbox-partial")),!1})),e(document).on("click","#yoimg-cropper-bckgr",(function(e){return e.preventDefault(),yoimgCancelCropImage(),!1})),e(document).on("keydown",(function(e){if(27===e.keyCode)return yoimgCancelCropImage(),!1})),e("input#large_size_h").length){r={action:"yoimg_get_custom_sizes_table_rows"};e.post(ajaxurl,r,(function(t){e("input#large_size_h").parents("table.form-table").after(t)}))}}));
